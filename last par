    - name: Download metallb manifest
      ansible.builtin.get_url:
        url: https://raw.githubusercontent.com/metallb/metallb/v0.14.8/config/manifests/metallb-native.yaml
        dest: ~/metallb-native.yaml

    - name: Apply metallb manifest
      kubernetes.core.k8s:
        kubeconfig: "/home/svetlinsem/.kube/config"
        state: present
        src: ~/metallb-native.yaml

    - name: Create a directory if it does not exist
      ansible.builtin.file:
        path: /metallb-config/
        state: directory

    - name: Create directory for metallb
      template:
        src: templates/metallb-config.yaml.j2
        dest: /metallb-config/metallb-config.yaml

    - name: Pause for 5 minutes to build app cache
      ansible.builtin.pause:
        minutes: 1

    - name: Apply metallb-config/ipaddres-pool
      kubernetes.core.k8s:
        kubeconfig: "/home/svetlinsem/.kube/config"
        state: present
        src: /metallb-config/metallb-config.yaml

    - name: Add a repository Ingress-nginx
      kubernetes.core.helm_repository:
       name: stable
       repo_url: https://kubernetes.github.io/ingress-nginx

    - name: Install Ingress-nginx
      kubernetes.core.helm:
        kubeconfig: "/home/svetlinsem/.kube/config"
        name: ingress-nginx
        chart_ref: oci://ghcr.io/nginxinc/charts/nginx-ingress --version 1.2.0
        release_namespace: ingress-nginx
        create_namespace: true

    - name: Add a repository rancher-latest
      kubernetes.core.helm_repository:
       name: rancher-latest
       repo_url: https://releases.rancher.com/server-charts/latest

    - name: Add a repository jetstack
      kubernetes.core.helm_repository:
       name: cert-manager
       repo_url: https://charts.jetstack.io

    - name: Cert-manager jetstack
      kubernetes.core.helm:
        kubeconfig: "/home/svetlinsem/.kube/config"
        name: cert-manager
        chart_ref: cert-manager/cert-manager
        release_namespace: cert-manager
        create_namespace: true
        values:
          installCRDs: true

    - name: Create name space Rancher
      kubernetes.core.k8s:
        kubeconfig: "/home/svetlinsem/.kube/config"
        name: cattle-system
        kind: Namespace
        state: present

    - name: Create a directory if it does not exist
      ansible.builtin.file:
        path: /kubernetes_config/rancher/
        state: directory

    - name: Create a directory if it does not exist
      ansible.builtin.file:
        path: /kubernetes_config/rancher/
        state: directory

    - name: Create load balancer
      template:
        src: templates/rancher-loadbalancer.yml.j2
        dest: /kubernetes_config/rancher/rancher-loadbalancer.yml

    - name: Apply load balancer
      kubernetes.core.k8s:
        kubeconfig: "/home/svetlinsem/.kube/config"
        state: present
        src: /kubernetes_config/rancher/rancher-loadbalancer.yml

    - name: Install Rancher
      kubernetes.core.helm:
        kubeconfig: "/home/svetlinsem/.kube/config"
        name: rancher
        chart_ref: rancher-latest/rancher
        release_namespace: cattle-system
        values:
         hostname: rancher.svetlinsem.com
         bootstrapPassword: admin